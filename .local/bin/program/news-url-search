#!/bin/sh

info=$(cat << EOF
news-url-search url
search and get news feeds in url page
rss and atom
EOF
)

if [ "$#" -ne 0 ]; then
    case "$1" in
        -h|--help)
            echo "$info"
            return 0
        ;;
    esac
else
    echo "error: insert url"
    echo "$info"
    return 1
fi

url="$(
    echo "$1" |
    sed 's/\/\(#\|\)$//'
)"

error_file="$(mktemp)"
website="$(curl --no-progress-meter --location "$url" 2>"$error_file")"
cat "$error_file"
rm -f "$error_file"

search_link() {
    website="$1"
    target="$2"

    echo "$website" |
        grep "$target" |
        sed 's/^.*href=\"//' |
        sed 's/\".*$//' |
        sed 's/\/\(#\|\)$//'
}

print_link() {
    links="$1"
    IFS='
'
    for link in $links; do
        case "$link" in
            /*)
                echo "${url}${link}"
            ;;
            *)
                echo "$link"
            ;;
        esac
    done
}

rss_links="$(search_link "$website" "/rss")"
atom_links="$(search_link "$website" "/atom")"

[ -n "$rss_links" ] && print_link "$rss_links"
[ -n "$atom_links" ] && print_link "$atom_links"
