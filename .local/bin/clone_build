#!/bin/sh

if [ "$#" -ne 1 ]; then
	echo "illegal number of parameters: $#"
	echo "possible parameters: install update"
elif [ ! "$1" = "install" ] && [ ! "$1" = "update" ]; then
	echo "wrong parameter"	
	echo "possible parameters: install update"
else
	current_dir="$(pwd)"

	prefix_dir="$HOME/.local"
	
	dev="$HOME/dev/program"

	mkdir -p "$dev"

	if [ "$1" = "install" ]; then
		git clone --recurse-submodules https://github.com/ifreund/river "$dev"/river
	fi
	
	cd "$dev"/river || return 1
	
	if [ "$1" = "install" ]; then
		git submodule init
	fi

	git pull

	git submodule update

	rm -rf zig-cache
	
	# -Dxwayland for xwayland support
	zig build -Drelease-safe -Dman-pages --prefix "$prefix_dir" install
	# zig build -Drelease-safe -Dman-pages -Dxwayland --prefix $prefix_dir install
	
	if [ "$1" = "install" ]; then
		git clone --recurse-submodules https://github.com/Alexays/Waybar "$dev"/waybar
	fi

	cd "$dev"/waybar || return 1

	git pull
	
	# build options enabled/disabled
	meson --reconfigure -Dprefix="$prefix_dir" -Dlibnl=enabled -Dlibudev=enabled -Dlibevdev=enabled -Dpulseaudio=enabled -Dsystemd=disabled -Ddbusmenu-gtk=disabled -Dman-pages=enabled -Dmpd=disabled -Dgtk-layer-shell=disabled -Drfkill=enabled -Dsndio=disabled -Dtests=disabled build
	
	ninja -C build install
	
	cd "$current_dir" || return 1
fi
