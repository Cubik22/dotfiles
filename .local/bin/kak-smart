#!/bin/sh

# wrapper around kak
# cd if directory
# open with kak if file
# supposed to be used just with aliases

# first parameter check if running as root
if [ "$#" -le 0 ]; then
    echo "please insert the first parameter: whether or no to run as root"
    return 1
fi

root="$1"

if [ "$root" != "yes" ] && [ "$root" != "no" ]; then
	echo "the first parameter determine if running as root or not"
	echo "values accepted are yes or no"
	return 1
fi

shift 1

if [ "$#" -gt 0 ]; then
    arg="$1"

    if [ -d "$arg" ]; then
        cd "$arg" || return 1
    elif [ -f "$arg" ]; then
    	if [ "$root" = "no" ]; then
        	/bin/kak "$arg"
        elif [ "$root" = "yes" ]; then
    	    doas /bin/kak "$arg"
    	fi
    else
        # if is not an existing directory or file
        # if nevertheless exists then do not open it
        # if it does not exists then can be opened as a file by kak
        if [ -e "$arg" ]; then
            echo "the argument exists but is neither a directory or file"
            /bin/ls --color=auto --human-readable -l "$arg"
    	    /bin/file "$arg"
        else
    		if [ "$root" = "no" ]; then
        		/bin/kak "$arg"
        	elif [ "$root" = "yes" ]; then
    		    doas /bin/kak "$arg"
    		fi
        fi
    fi
else
	if [ "$root" = "no" ]; then
		/bin/kak "$(fzf)"
	elif [ "$root" = "yes" ]; then
	    doas /bin/kak "$(fzf)"
	fi
fi
